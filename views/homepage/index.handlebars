<script>
    //Marker database table json
    var addMarkers = {{{result}}}
</script>
<style>
    #map {
        height: 100%;
        /*width: 100%;*/
        overflow: visible;
    }
</style>


<div class="container">
    <div class="row">
        <div class="col s12">

            <div class="row" style="height: 400px;">
                <div id="map" class="col m8 s12"></div>
                <div class="col m4 s12" style="overflow-y:scroll; height: 100%">
                    <ul class="collection">
                        {{#each marker}}
                            <li class="collection-item avatar">
                                <img src="" alt="" class="circle">
                                <span class="title">{{name}}</span>
                                <p>{{lat}} <br> {{lng}}
                                </p>
                                <a href="" class="secondary-content"><i class="material-icons">grade</i></a>
                            </li>
                        {{/each}}
                    </ul>
                </div>
            </div>

            <h2> Add marker to database: </h2>
            <form name="markers" action="/markers" method="post">
                <div class="input-field">
                    <label for="inputName">Name</label>
                    <input type="text" id="inputName" name="inputName">
                </div>
                <div class="input-field">
                    <label for="inputLatitude">Latitude</label>
                    <input type="text" id="inputLatitude" name="inputLatitude">
                </div>
                <div class="input-field">
                    <label for="inputLongitude">Longitude</label>
                    <input type="text" id="inputLongitude" name="inputLongitude">
                </div>
                <button type="submit" onClick="testing()" class="btn btn-primary">Add Marker</button>
            </form>

        </div>
    </div>
</div>

<!-- Google Map implementation -->
<script>
    var initMap = function() {
        var map = new google.maps.Map(document.getElementById('map'), {
            center: {
                lat: 40.6,
                lng: -74
            },
            zoom: 10
        });
        // if brower support available, ask user for location data and set the map view
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                initialLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                map.setCenter(initialLocation);
            });
        }
        // for each marker passed through, add it to the map with a popup
        addMarkers.forEach(function(marker) {
            console.log(marker.lat);
            var position = new google.maps.LatLng(marker.lat, marker.lng);
            var googleMarker = new google.maps.Marker({
                position: position,
                title: marker.name,
                map: map
            });
            // Bind a popup to the marker
            googleMarker.addListener("click", function() {
                var infoWindow = new google.maps.InfoWindow({
                    content: "<h3>" + marker.name + "</h3>" + "</br>" + "<a href='/'>Homepage link</a>" + "</br>" + "<"
                });
                infoWindow.open(map, googleMarker);
            });
        });
    };
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBW0cN_4dkCiDcup9Cc6YXIPyANXs9zPic&callback=initMap">
</script>
