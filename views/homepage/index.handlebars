<script>
  //Marker database table json
  var addMarkers = {{{result}}}
</script>
<style>
       #map {
        height: 400px;
        width: 100%;
       }
</style>
<div class="container">
  <div class="row">
    <div class="col-sm-12">
      {{#if cur_user}}
      <h1>Hey <span style="color: red;">{{cur_user.username}}</span></h1>
      {{else}}
      <center><h1>Homepage</h1></center>
      <div id="map"></div>
      <script>
      var initMap = function() {

        var map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 40.6, lng: -74},
          zoom: 10
        });

        // if brower support available, ask user for location data and set the map view
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            initialLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
            map.setCenter(initialLocation);
          });
        }

        // for each marker passed through, add it to the map with a popup
        addMarkers.forEach(function(marker) {
          console.log(marker.lat);
          var position = new google.maps.LatLng(marker.lat, marker.lng);
          var googleMarker = new google.maps.Marker({
            position: position,
            title: marker.name,
            map: map
          });
          // Bind a popup to the marker
          googleMarker.addListener("click", function() {
            var infoWindow = new google.maps.InfoWindow({content: "<h3>"+marker.name+"</h3>"+"</br>"+"<a href='/'>Homepage link</a>"+"</br>"+"<"});
            infoWindow.open(map, googleMarker);
          });
        });

        function testing (){
          var newlat = document.getElementById('inputLatitude').innerHTML;
          var newlng = document.getElementById('inputLongitude').inneHTML;
          var newtitle = document.getElementById('inputName').innerHTML;
          var newposition = new google.maps.LatLng(newlat, newlng);
          var googleMarker = new google.maps.Marker({
            position: newposition,
            title: newtitle,
            map: map
          });
          // Bind a popup to the marker
          googleMarker.addListener("click", function() {
            var infoWindow = new google.maps.InfoWindow({content: "<h3>"+marker.name+"</h3>"+"</br>"+"<a href='/'>Homepage link</a>"+"</br>"});
            infoWindow.open(map, googleMarker);
          });
        };
      };
      </script>
      <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBW0cN_4dkCiDcup9Cc6YXIPyANXs9zPic&callback=initMap">
      </script>

      <h2> Add marker to database: </h2>
      <form name="markers" action="/markers" method="post">
        <div class="input-field">
            <label for="inputName">Name</label>
            <input type="text" id="inputName" name="inputName">
        </div>
        <div class="input-field">
            <label for="inputLatitude">Latitude</label>
            <input type="text" id="inputLatitude" name="inputLatitude">
        </div>
        <div class="input-field">
            <label for="inputLongitude">Longitude</label>
            <input type="text" id="inputLongitude" name="inputLongitude">
        </div>
        <button type="submit" onClick="testing()" class="btn btn-primary">Add Marker</button>
      </form>

      {{/if}}
    </div>
  </div>
</div>
